<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>PVC ê²¬ì  ê³„ì‚°ê¸°</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    label { display: block; margin-top: 15px; font-weight: bold; }
    select, input, button {
      padding: 10px; font-size: 16px; width: 300px; margin-bottom: 10px;
    }
    #resultBox {
      margin-top: 20px; padding: 15px; border: 1px solid #ccc;
      background: #f7f7f7; font-size: 18px;
    }
  </style>
</head>
<body>

<h2>ğŸªŸ PVC ê²¬ì  ê³„ì‚°ê¸°</h2>

<label>í”„ë ˆì„ ì„ íƒ</label>
<select id="sheetName"><option>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</option></select>

<label>ë¬¸ì§ ì¢…ë¥˜</label>
<p id="sash">-</p>

<label>ì§ìˆ˜ë¬¸</label>
<select id="door">
  <option value="2">2ì§ë¬¸</option>
  <option value="3">3ì§ë¬¸</option>
  <option value="4">4ì§ë¬¸</option>
</select>

<label>ê°€ë¡œ (mm)</label>
<input type="number" id="width" placeholder="ì˜ˆ: 1000">

<label>ì„¸ë¡œ (mm)</label>
<input type="number" id="height" placeholder="ì˜ˆ: 1200">

<label>ìœ ë¦¬ ì„ íƒ</label>
<select id="glass">
  <option value="0">22 íˆ¬ëª…+íˆ¬ëª…</option>
  <option value="1">22 ê·¸ë¦°+íˆ¬ëª…</option>
  <option value="2">22 íˆ¬ëª…+ë¶ˆíˆ¬ëª…</option>
</select>

<label>ìˆ˜ëŸ‰</label>
<input type="number" id="qty" value="1">

<button onclick="submitEstimate()">ğŸ“¥ ê²¬ì  í™•ì¸</button>

<div id="resultBox">ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>

<script>
  const URL = "https://script.google.com/macros/s/AKfycbxWUsCmj5a7sM2pL2yTJx4tvAKg8gGXk6sf5mMwhssJm5PPzWOah4x6_5UtsBfjBM38zg/exec";

  // 1) ì‹œíŠ¸ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
  fetch(URL)
    .then(r => r.json())
    .then(data => {
      const sel = document.getElementById("sheetName");
      sel.innerHTML = '<option value="">-- ì‹œíŠ¸ ì„ íƒ --</option>';
      data.sheets.forEach(n => {
        const o = document.createElement("option");
        o.value = n; o.textContent = n;
        sel.appendChild(o);
      });
    });

  // 2) ë¬¸ì§ ì¢…ë¥˜ í‘œì‹œ
  document.getElementById("sheetName").addEventListener("change", () => {
    const sheet = document.getElementById("sheetName").value;
    if (!sheet) return;
    fetch(`${URL}?sheet=${encodeURIComponent(sheet)}`)
      .then(r => r.json())
      .then(data => {
        document.getElementById("sash").textContent = data.note ? "-" : data.sash;  
      });
  });

  // 3) ê²¬ì  ê³„ì‚° (GET ë°©ì‹)
  function submitEstimate() {
    const sheet = document.getElementById("sheetName").value;
    const door = document.getElementById("door").value;
    const width = document.getElementById("width").value;
    const height = document.getElementById("height").value;
    const glass = document.getElementById("glass").value;
    const qty = document.getElementById("qty").value;

    if (!sheet || !width || !height || !qty) {
      alert("ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."); return;
    }

    const qs = new URLSearchParams({ sheet, door, glass, width, height, qty });
    fetch(`${URL}?${qs.toString()}`)
      .then(r => r.json())
      .then(data => {
        if (data.error) throw new Error(data.message);
        const amt = Math.floor(data.result).toLocaleString();
        document.getElementById("resultBox").innerHTML =
          `ğŸ’° ê²¬ì ê¸ˆì•¡(VATë³„ë„): <strong>${amt}ì›</strong><br>ğŸ“ ${data.note}`;
      })
      .catch(e => {
        alert("ê³„ì‚° ì¤‘ ì˜¤ë¥˜ ë°œìƒ: " + e.message);
      });
  }
</script>

</body>
</html>
