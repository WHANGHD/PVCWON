<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>하나건업 PVC 견적</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 40px auto; }
    label { display: block; margin-top: 20px; font-weight: bold; }
    select, input { width: 100%; padding: 8px; font-size: 14px; }
    button { margin-top: 20px; padding: 10px; font-size: 16px; width: 100%; }
    #resultBox { margin-top: 30px; padding: 15px; background: #f2f2f2; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h2>PVC 견적 계산기</h2>

  <label>프레임 선택</label>
  <select id="sheetName"></select>

  <label>문짝 종류</label>
  <div id="sash">-</div>

  <label>짝수문 선택</label>
  <select id="door">
    <option value="2">2짝문</option>
    <option value="3">3짝문</option>
    <option value="4">4짝문</option>
  </select>

  <label>가로 (mm)</label>
  <input type="number" id="width" />

  <label>세로 (mm)</label>
  <input type="number" id="height" />

  <label>유리 선택</label>
  <select id="glass">
    <option value="0">22투명+투명</option>
    <option value="1">22그린+투명</option>
    <option value="2">22투명+불투명</option>
  </select>

  <label>수량</label>
  <input type="number" id="qty" value="1" />

  <button onclick="calculate()">견적 확인</button>

  <div id="resultBox" style="display:none;">
    <h3>견적 결과</h3>
    <div id="resultText">결과를 계산 중입니다...</div>
    <div id="note" style="margin-top:10px; font-style: italic;"></div>
  </div>

  <script>
    const URL = "https://script.google.com/macros/s/AKfycbwuOrswYidOi0FocOE-Q5ZsyPGzwIDHgqwfHiN9vVOXSZ9Ix7a24dY148nM7X421j5ZpA/exec";

    function loadSheetData(sheet = "115") {
      fetch(URL + "?sheet=" + sheet)
        .then(res => res.json())
        .then(data => {
          // 프레임 목록
          const sheetSelect = document.getElementById("sheetName");
          sheetSelect.innerHTML = "";
          data.sheets.forEach(name => {
            const opt = document.createElement("option");
            opt.value = name;
            opt.textContent = name;
            sheetSelect.appendChild(opt);
          });

          // 문짝 종류, 하단 문구
          document.getElementById("sash").textContent = data.sash;
          document.getElementById("note").textContent = data.note;
        });
    }

    // 시트 변경 시 데이터 새로 불러오기
    document.addEventListener("DOMContentLoaded", () => {
      loadSheetData();
      document.getElementById("sheetName").addEventListener("change", (e) => {
        loadSheetData(e.target.value);
      });
    });

    function calculate() {
      const sheetName = document.getElementById("sheetName").value;
      const width = Number(document.getElementById("width").value);
      const height = Number(document.getElementById("height").value);
      const door = Number(document.getElementById("door").value); // 2, 3, 4
      const glass = Number(document.getElementById("glass").value); // 0, 1, 2
      const qty = Number(document.getElementById("qty").value);

      fetch(URL, {
        method: "POST",
        body: JSON.stringify({ sheetName, width, height, door, glass, qty }),
        headers: { "Content-Type": "application/json" }
      })
        .then(res => res.json())
        .then(data => {
          const resultBox = document.getElementById("resultBox");
          const resultText = document.getElementById("resultText");
          const note = document.getElementById("note");

          if (data.error) {
            resultText.innerHTML = `⚠️ 오류: ${data.message}`;
          } else {
            resultText.innerHTML = `
              프레임: ${sheetName}<br>
              문짝: ${document.getElementById("sash").textContent}<br>
              짝수문: ${door}짝문<br>
              유리: ${document.getElementById("glass").selectedOptions[0].text}<br>
              규격: ${width} × ${height} mm<br>
              수량: ${qty}개<br><br>
              공급가액: <b>₩${Math.floor(data.result).toLocaleString()}</b> <span style="font-size:13px;">(VAT 별도)</span>
            `;
            note.textContent = data.note;
          }

          resultBox.style.display = "block";
        });
    }
  </script>
</body>
</html>
