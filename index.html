<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>PVC 견적 계산기</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    label { display: block; margin-top: 15px; font-weight: bold; }
    select, input, button {
      padding: 10px;
      font-size: 16px;
      width: 300px;
      margin-bottom: 10px;
    }
    #resultBox {
      margin-top: 20px;
      padding: 15px;
      border: 1px solid #ccc;
      background: #f7f7f7;
      font-size: 18px;
    }
  </style>
</head>
<body>

<h2>🪟 PVC 견적 계산기</h2>

<label for="sheetName">프레임 선택</label>
<select id="sheetName">
  <option value="">불러오는 중...</option>
</select>

<label>문짝 종류</label>
<p id="sash">-</p>

<label for="door">짝수문 선택</label>
<select id="door">
  <option value="2">2짝문</option>
  <option value="3">3짝문</option>
  <option value="4">4짝문</option>
</select>

<label>가로 (mm)</label>
<input type="number" id="width" placeholder="예: 1000">

<label>세로 (mm)</label>
<input type="number" id="height" placeholder="예: 1200">

<label>유리 선택</label>
<select id="glass">
  <option value="0">22 투명+투명</option>
  <option value="1">22 그린+투명</option>
  <option value="2">22 투명+불투명</option>
</select>

<label>수량</label>
<input type="number" id="qty" value="1">

<button onclick="submitEstimate()">📥 견적 확인</button>

<div id="resultBox">결과가 여기에 표시됩니다</div>

<script>
const URL = "https://script.google.com/macros/s/AKfycbwX5qwBF4uEDtkYJhJa6pc6Zst2-hpvHJQr2kxKTFPvT6U2GbSa2PcxoOfSqtHxk1jAnQ/exec";

// 시트 목록 불러오기
fetch(URL)
  .then(res => res.json())
  .then(data => {
    const select = document.getElementById("sheetName");
    select.innerHTML = '<option value="">-- 프레임 선택 --</option>';
    data.sheets.forEach(name => {
      const opt = document.createElement("option");
      opt.value = name;
      opt.textContent = name;
      select.appendChild(opt);
    });
  });

// 문짝 종류 표시
document.getElementById("sheetName").addEventListener("change", () => {
  const sheet = document.getElementById("sheetName").value;
  if (!sheet) return;
  fetch(`${URL}?sheet=${encodeURIComponent(sheet)}`)
    .then(res => res.json())
    .then(data => {
      document.getElementById("sash").textContent = data.sash || "-";
    });
});

// 견적 제출
function submitEstimate() {
  const sheetName = document.getElementById("sheetName").value;
  const door = parseInt(document.getElementById("door").value);
  const width = parseInt(document.getElementById("width").value);
  const height = parseInt(document.getElementById("height").value);
  const glass = parseInt(document.getElementById("glass").value);
  const qty = parseInt(document.getElementById("qty").value);

  if (!sheetName || isNaN(width) || isNaN(height) || isNaN(door) || isNaN(glass) || isNaN(qty)) {
    alert("모든 항목을 정확히 입력해주세요.");
    return;
  }

  fetch(URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ sheetName, door, width, height, glass, qty })
  })
    .then(res => res.json())
    .then(data => {
      if (data.error) throw new Error(data.message);
      const amount = Math.floor(data.result);
      const note = data.note || "";
      document.getElementById("resultBox").innerHTML =
        `💰 견적금액(VAT별도): <strong>${amount.toLocaleString()} 원</strong><br><br>📝 ${note}`;
    })
    .catch(err => {
      alert("견적 계산 중 오류 발생: " + err.message);
    });
}
</script>

</body>
</html>
