<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>PVC ê²¬ì  ê³„ì‚°ê¸°</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    label { display: block; margin-top: 15px; font-weight: bold; }
    select, input, button {
      padding: 10px;
      font-size: 16px;
      width: 300px;
      margin-bottom: 10px;
    }
    #resultBox {
      margin-top: 20px;
      padding: 15px;
      border: 1px solid #ccc;
      background: #f7f7f7;
      font-size: 18px;
    }
  </style>
</head>
<body>

<h2>ğŸªŸ PVC ê²¬ì  ê³„ì‚°ê¸°</h2>

<label for="sheetName">í”„ë ˆì„ ì„ íƒ</label>
<select id="sheetName">
  <option value="">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</option>
</select>

<label>ë¬¸ì§ ì¢…ë¥˜</label>
<p id="sash">-</p>

<label for="door">ì§ìˆ˜ë¬¸ ì„ íƒ</label>
<select id="door">
  <option value="2">2ì§ë¬¸</option>
  <option value="3">3ì§ë¬¸</option>
  <option value="4">4ì§ë¬¸</option>
</select>

<label>ê°€ë¡œ (mm)</label>
<input type="number" id="width" placeholder="ì˜ˆ: 1000">

<label>ì„¸ë¡œ (mm)</label>
<input type="number" id="height" placeholder="ì˜ˆ: 1200">

<label>ìœ ë¦¬ ì„ íƒ</label>
<select id="glass">
  <option value="0">22 íˆ¬ëª…+íˆ¬ëª…</option>
  <option value="1">22 ê·¸ë¦°+íˆ¬ëª…</option>
  <option value="2">22 íˆ¬ëª…+ë¶ˆíˆ¬ëª…</option>
</select>

<label>ìˆ˜ëŸ‰</label>
<input type="number" id="qty" value="1">

<button onclick="submitEstimate()">ğŸ“¥ ê²¬ì  í™•ì¸</button>

<div id="resultBox">ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>

<script>
const URL = "https://script.google.com/macros/s/AKfycbwX5qwBF4uEDtkYJhJa6pc6Zst2-hpvHJQr2kxKTFPvT6U2GbSa2PcxoOfSqtHxk1jAnQ/exec";

// ì‹œíŠ¸ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
fetch(URL)
  .then(res => res.json())
  .then(data => {
    const select = document.getElementById("sheetName");
    select.innerHTML = '<option value="">-- í”„ë ˆì„ ì„ íƒ --</option>';
    data.sheets.forEach(name => {
      const opt = document.createElement("option");
      opt.value = name;
      opt.textContent = name;
      select.appendChild(opt);
    });
  });

// ë¬¸ì§ ì¢…ë¥˜ í‘œì‹œ
document.getElementById("sheetName").addEventListener("change", () => {
  const sheet = document.getElementById("sheetName").value;
  if (!sheet) return;
  fetch(`${URL}?sheet=${encodeURIComponent(sheet)}`)
    .then(res => res.json())
    .then(data => {
      document.getElementById("sash").textContent = data.sash || "-";
    });
});

// ê²¬ì  ì œì¶œ
function submitEstimate() {
  const sheetName = document.getElementById("sheetName").value;
  const door = parseInt(document.getElementById("door").value);
  const width = parseInt(document.getElementById("width").value);
  const height = parseInt(document.getElementById("height").value);
  const glass = parseInt(document.getElementById("glass").value);
  const qty = parseInt(document.getElementById("qty").value);

  if (!sheetName || isNaN(width) || isNaN(height) || isNaN(door) || isNaN(glass) || isNaN(qty)) {
    alert("ëª¨ë“  í•­ëª©ì„ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    return;
  }

  fetch(URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ sheetName, door, width, height, glass, qty })
  })
    .then(res => res.json())
    .then(data => {
      if (data.error) throw new Error(data.message);
      const amount = Math.floor(data.result);
      const note = data.note || "";
      document.getElementById("resultBox").innerHTML =
        `ğŸ’° ê²¬ì ê¸ˆì•¡(VATë³„ë„): <strong>${amount.toLocaleString()} ì›</strong><br><br>ğŸ“ ${note}`;
    })
    .catch(err => {
      alert("ê²¬ì  ê³„ì‚° ì¤‘ ì˜¤ë¥˜ ë°œìƒ: " + err.message);
    });
}
</script>

</body>
</html>
