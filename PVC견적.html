
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>(ì£¼)í•˜ë‚˜ê±´ì—… PVC ê²¬ì  ê³„ì‚°ê¸°</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0; padding: 20px;
      background-color: #f4f4f4;
      display: flex; justify-content: center;
    }
    .wrapper { display: flex; flex-direction: row; gap: 20px; max-width: 1200px; width: 100%; }
    .form-container, .summary-container {
      background: #fff; padding: 25px;
      border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }
    .form-container { flex: 1; }
    .summary-container { width: 350px; max-height: 700px; overflow-y: auto; }
    h2 { text-align: center; color: #333; }
    label { display: block; margin-top: 12px; font-weight: bold; }
    select, input[type="number"] {
      width: 100%; padding: 10px; font-size: 15px;
      border: 1px solid #ccc; border-radius: 6px; margin-top: 5px; margin-bottom: 10px;
    }
    .button-group { display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
    button {
      flex: 1; background-color: #007BFF; color: white;
      padding: 10px; font-size: 16px; border: none;
      border-radius: 6px; cursor: pointer;
    }
    button:hover { background-color: #0056b3; }
    #result { margin-top: 20px; padding: 15px; background: #f8f8f8;
      border-radius: 6px; font-size: 15px; border: 1px solid #ddd; }
    .estimate-box {
      background: #fcfcfc; border: 1px solid #ccc;
      border-radius: 8px; padding: 12px; margin-bottom: 12px;
      font-size: 14px; line-height: 1.6; position: relative;
    }
    .estimate-box .close-btn {
      position: absolute; top: 6px; left: 10px;
      color: #888; cursor: pointer; font-weight: bold;
    }
    .estimate-box .close-btn:hover { color: red; }
    @media (max-width: 768px) {
      body { padding: 10px; }
      .wrapper { flex-direction: column; }
      .summary-container { width: 100%; margin-top: 20px; max-height: none; }
      .button-group { flex-direction: column; }
      button { width: 100%; }
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="form-container">
      <h2>(ì£¼)í•˜ë‚˜ê±´ì—… PVC ê²¬ì  ê³„ì‚°ê¸°</h2>
      <label>í”„ë ˆì„ (ì‹œíŠ¸ ì„ íƒ)</label><select id="sheet"></select>
      <label>ì°½ì§ (ì§ìˆ˜)</label>
      <select id="sash"><option value="2ì§">2ì§</option><option value="3ì§">3ì§</option><option value="4ì§">4ì§</option></select>
      <label>ìœ ë¦¬ ì¢…ë¥˜</label>
      <select id="glass"><option value="0">22íˆ¬ëª…+íˆ¬ëª…</option><option value="1">22ê·¸ë¦°+íˆ¬ëª…</option><option value="2">22íˆ¬ëª…+ë¸”íˆ¬ëª…</option></select>
      <label>í­ (W)</label><input type="number" id="width" placeholder="ì˜ˆ: 2000">
      <label>ë†’ì´ (H)</label><input type="number" id="height" placeholder="ì˜ˆ: 2000">
      <label>ìˆ˜ëŸ‰</label><input type="number" id="qty" placeholder="ì˜ˆ: 1">
      <div class="button-group"><button onclick="calculateEstimate()">ê²¬ì  í™•ì¸</button><button onclick="saveEstimate()">ê²¬ì  ì €ì¥</button></div>
      <div id="result"></div>
    </div>
    <div class="summary-container">
      <h3 style="text-align:center;">ğŸ“Œ ê°„ë‹¨ ê²¬ì ì„œ</h3>
      <div id="summaryList"></div>
    </div>
  </div>
<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyGEFr58_sZy7wn4os33HQLn7OQVIbZTQkdZsESbc3axcFQfvgB6-dqGelHzvfr_eFw5Q/exec";
let lastResult = null;
async function loadSheets() {
  try {
    const res = await fetch(API_URL);
    const data = await res.json();
    console.log("âœ… ì‹œíŠ¸ ëª©ë¡ ë°›ì•„ì˜´:", data);
    const sheetSelect = document.getElementById("sheet");
    sheetSelect.innerHTML = data.sheets
      .filter(name => typeof name === "string" && name.trim().length > 0)
      .map(name => {
        const safe = name.replace(/</g, "&lt;").replace(/>/g, "&gt;");
        console.log("â–¶ ì‹œíŠ¸:", JSON.stringify(safe));
        return `<option value="${safe}">${safe}</option>`;
      }).join('');
  } catch (err) {
    console.error("âŒ ì‹œíŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", err);
    document.getElementById("sheet").innerHTML = `<option disabled>ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨</option>`;
  }
}
async function calculateEstimate() {
  const s = document.getElementById("sheet").value;
  const d = document.getElementById("sash").value;
  const g = document.getElementById("glass").value;
  const gt = document.getElementById("glass").selectedOptions[0].text;
  const w = document.getElementById("width").value;
  const h = document.getElementById("height").value;
  const q = document.getElementById("qty").value;
  const res = await fetch(`${API_URL}?sheet=${s}&sash=${d}&glass=${g}&width=${w}&height=${h}&qty=${q}`);
  const data = await res.json();
  const total = Math.round(parseFloat(data.result) || 0);
  const supply = Math.round(total / 1.1);
  const unit = Math.round(supply / parseInt(q));
  document.getElementById("result").innerHTML = `
    <strong>ğŸ§¾ ê²¬ì  ìƒì„¸</strong><br>
    í”„ë ˆì„: ${s}<br>ë¬¸ì§: ${d}<br>ìœ ë¦¬: ${gt}<br>ê·œê²©: ${w} Ã— ${h}<br>
    ìˆ˜ëŸ‰: ${q}ê°œ<br>ë‹¨ê°€: â‚©${unit.toLocaleString()}<br>
    ê³µê¸‰ê°€ì•¡: â‚©${supply.toLocaleString()}<br>
    VAT (10%): â‚©${(total - supply).toLocaleString()}<br>
    <hr><strong>ì´ ê²¬ì : â‚©${total.toLocaleString()}</strong>`;
  lastResult = { time: new Date().toLocaleString(), sheet: s, sash: d, width: w, height: h, qty: q, glassText: gt, unit, supply, total };
}
function saveEstimate() {
  if (!lastResult) return alert("ë¨¼ì € 'ê²¬ì  í™•ì¸'ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.");
  const d = document.createElement("div");
  d.className = "estimate-box";
  d.innerHTML = `<span class="close-btn" onclick="this.parentElement.remove()">Ã—</span>
    <div><strong>${lastResult.time}</strong></div>
    [${lastResult.sheet}] ${lastResult.sash} / ${lastResult.width}Ã—${lastResult.height} / ${lastResult.qty}EA / ${lastResult.glassText}<br>
    ë‹¨ê°€: â‚©${lastResult.unit.toLocaleString()}<br>
    ê³µê¸‰ê°€ì•¡: â‚©${lastResult.supply.toLocaleString()}<br>
    <strong>ì´ ê²¬ì : â‚©${lastResult.total.toLocaleString()}</strong>`;
  document.getElementById("summaryList").prepend(d);
}
window.onload = loadSheets;
</script>
</body>
</html>
